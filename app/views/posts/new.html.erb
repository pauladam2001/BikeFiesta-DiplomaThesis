<% if alert %>
  <div class="alert-danger">
    <span class="close-button" onclick="this.parentElement.style.display='none';">&times;</span>
    <p class="alert-paragraph"><%= alert %></p>
  </div>
<% end%>
<div class="">
  <div class="">
    <h1 class=""><%= @post.persisted? && params[:upload] == "false" ? "Edit" : "New" %> Post</h1>
  </div>
  <% if !@post.persisted? %>
    <div class="">
      <%= form_for @post do |f| %>
        <div class="">
          <div class="">
            <div class="">
              <div class="">
                <label for="" class="">
                  Post Name (Maximum 20 characaters)
                </label>
                <div class="">
                  <%= f.text_field :name, class: "" %>
                </div>
                <label for="" class="">
                  Description
                </label>
                <div class="">
                  <%= f.text_field :description, class: "" %>
                </div>
                <label for="" class="">
                  Short Description (Maximum 50 characters)
                </label>
                <div class="">
                  <%= f.text_field :short_description, class: "" %>
                </div>
                <label for="" class="">
                  Price
                </label>
                <div class="">
                  <%= f.number_field :price, class: "" %>
                </div>
                <label for="" class="">
                  Color
                </label>
                <div class="">
                  <%= f.select :color_id, options_for_select(@colors.collect { |a| [a[0], a[1]]}, f.object.color_id), {}, class: "max-w-lg block focus:ring-indigo-500 focus:border-indigo-500 w-full shadow-sm sm:max-w-xs sm:text-sm border-gray-300 rounded-md" %>
                </div>
                <label for="" class="">
                  Year
                </label>
                <div class="">
                  <%= f.select :year, (Time.now.year).downto(Time.now.year - 70).to_a %>
                </div>
                <label for="" class="">
                  Location
                </label>
                <div class="">
                  <%= f.select :location_id, options_for_select(@locations.collect { |a| [a[0], a[1]]}, f.object.location_id), {}, class: "max-w-lg block focus:ring-indigo-500 focus:border-indigo-500 w-full shadow-sm sm:max-w-xs sm:text-sm border-gray-300 rounded-md" %>
                </div>
                <label for="" class="">
                  Brand Name
                </label>
                <div class="">
                  <%= f.select :brandname_id, options_for_select(@brand_names.collect { |a| [a[0], a[1]]}, f.object.brandname_id), {}, class: "max-w-lg block focus:ring-indigo-500 focus:border-indigo-500 w-full shadow-sm sm:max-w-xs sm:text-sm border-gray-300 rounded-md" %>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="">
          <div class="">
            <%= link_to posts_path, class: "" do %>
              Cancel
            <% end %>
            <button type="submit" class="">
              Save
            </button>
          </div>
        </div>
      <% end %>
      
    </div>
  <% else %>
    <% if params[:upload] == "true" %>
      <div class="dropzone dropzone-flex drop-title drop-container" id="dropzone-form"></div>
      <%= button_to "Upload Files", posts_path, id: "createPost", method: :get, :class => "button" %>
    <% else %>
      Edit others, not assets
    <% end %>
  <% end %>
</div>

<script src="https://unpkg.com/dropzone@6.0.0-beta.1/dist/dropzone-min.js"></script>
<link href="https://unpkg.com/dropzone@6.0.0-beta.1/dist/dropzone.css" rel="stylesheet" type="text/css" />

<script type="text/javascript">
  const createPostButton = document.getElementById('createPost');
  let myDropzone = null;
  let dropzoneDiv = document.getElementById("dropzone-form");

  if (myDropzone == null) {
    myDropzone = new Dropzone("div#dropzone-form", { uploadMutliple: true,
                                                    parallelUploads: 100,
                                                    maxFiles: 100,
                                                    acceptedFiles: ".jpeg, .jpg, .png",
                                                    url: `/posts/post_upload_files?post_id=<%= params[:post_id] %>`,
                                                    autoProcessQueue: false,
                                                    addRemoveLinks: true
                                                  });
  } else {
    myDropzone.enable();
  }

  createPostButton.addEventListener('click', () => {
    myDropzone.processQueue();
  });
</script>
