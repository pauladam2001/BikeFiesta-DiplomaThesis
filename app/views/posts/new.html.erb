<% if alert %>
  <div class="alert-danger">
    <span class="close-button" onclick="this.parentElement.style.display='none';">&times;</span>
    <p class="alert-paragraph"><%= alert %></p>
  </div>
<% end%>
<div class="">
  <div class="edit-post-title-div">
    <% if @post.persisted? %>
      <% if params[:upload] == "true" %>
        <h1 class="">Upload Images</h1>
      <% else %>
        <h1 class="">Edit Post</h1>
      <% end %>
    <% else %>
      <h1 class="">New Post</h1>
    <% end %>
  </div>
  <% if !@post.persisted? %>
    <div class="add-post-div container">
      <%= form_for @post do |f| %>
        <div class="">
          <div class="">
            <div class="">
              <div class="">
                <label for="" class="">
                  Post Name (Maximum 20 characaters)
                </label>
                <div class="">
                  <%= f.text_field :name, class: "" %>
                </div>
                <label for="" class="">
                  Description
                </label>
                <div class="">
                  <%= f.text_area :description, cols: "50", rows: "10", class: "" %>
                </div>
                <label for="" class="">
                  Short Description (Maximum 50 characters)
                </label>
                <div class="">
                  <%= f.text_field :short_description, class: "" %>
                </div>
                <label for="" class="">
                  Price
                </label>
                <div class="">
                  <%= f.number_field :price, class: "" %>
                </div>
                <div class="">
                  <%= f.select :color_id, options_for_select([["Select a color", nil]] + @colors.collect { |a| [a[0], a[1]]}, f.object.color_id), {}, class: "" %>
                </div>
                <div class="">
                  <%= f.select :year, [["Select an year", nil]] + (Time.now.year).downto(Time.now.year - 70).to_a %>
                </div>
                <div class="select-div">
                  <%= f.select :location_id, options_for_select([["Select a location", nil]] + @locations.collect { |a| [a[0], a[1]]}, f.object.location_id), {}, class: "" %>
                </div>
                <div class="">
                  <%= f.select :brandname_id, options_for_select([["Select a brand name", nil]] + @brand_names.collect { |a| [a[0], a[1]]}, f.object.brandname_id), {}, class: "" %>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="">
          <div class="">
            <%= link_to posts_path, class: "cancel-link" do %>
              Cancel
            <% end %>
            <button type="submit" class="button">
              Go to Upload
            </button>
          </div>
        </div>
      <% end %>
      
    </div>
  <% else %>
    <% if params[:upload] == "true" %>
      <div class="upload-info-div-1">
        <span style="margin-left: 2.5rem">Please upload maximum 5 images</span>
        <br/>
        <span>At least one image must include the entire bike</span>
      </div>
      <div class="dropzone dropzone-flex drop-title drop-container dropzone-styles" id="dropzone-form"></div>
      <div class="upload-info-div-2">
        <%= button_to "Upload", posts_path, id: "createPost", method: :get, :class => "button", :style => "margin-left: 7.5rem; margin-bottom: 0.5rem;" %>
        <span>After uploading it takes up to 10 minutes to validate your post</span>
      </div>
    <% else %>
      Edit others, not assets
    <% end %>
  <% end %>
</div>

<script src="https://unpkg.com/dropzone@6.0.0-beta.1/dist/dropzone-min.js"></script>
<link href="https://unpkg.com/dropzone@6.0.0-beta.1/dist/dropzone.css" rel="stylesheet" type="text/css" />

<script type="text/javascript">
  const createPostButton = document.getElementById('createPost');
  let myDropzone = null;
  let dropzoneDiv = document.getElementById("dropzone-form");

  if (myDropzone == null) {
    myDropzone = new Dropzone("div#dropzone-form", { uploadMutliple: true,
                                                    parallelUploads: 100,
                                                    maxFiles: 100,
                                                    acceptedFiles: ".jpeg, .jpg, .png",
                                                    url: `/posts/post_upload_files?post_id=<%= params[:id] %>`,
                                                    autoProcessQueue: false,
                                                    addRemoveLinks: true
                                                  });
  } else {
    myDropzone.enable();
  }

  createPostButton.addEventListener('click', () => {
    myDropzone.processQueue();
  });
</script>
